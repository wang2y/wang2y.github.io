<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SpringBoot核心 | 幸运的是遇见你</title><meta name="author" content="王小小友"><meta name="copyright" content="王小小友"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SpringBoot核心 一、配置文件1.yaml 1.1 yaml简介 YAML是“YAML Ain’t Markup Languge”（YAML不是一种标记语言）的递归缩写。在开发这种语言时，YAML意思其实是：“Yet Another Markup Language”（仍然是一种标记语言）。 1.2 基本语法  key: value;kv之间有空格 大小写敏感 使用缩进表示层级关系 缩进不允">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot核心">
<meta property="og:url" content="http://example.com/2023/10/09/SpringBoot%E6%A0%B8%E5%BF%83/index.html">
<meta property="og:site_name" content="幸运的是遇见你">
<meta property="og:description" content="SpringBoot核心 一、配置文件1.yaml 1.1 yaml简介 YAML是“YAML Ain’t Markup Languge”（YAML不是一种标记语言）的递归缩写。在开发这种语言时，YAML意思其实是：“Yet Another Markup Language”（仍然是一种标记语言）。 1.2 基本语法  key: value;kv之间有空格 大小写敏感 使用缩进表示层级关系 缩进不允">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/bloghead.jpg">
<meta property="article:published_time" content="2023-10-09T13:56:49.000Z">
<meta property="article:modified_time" content="2023-10-09T13:58:03.260Z">
<meta property="article:author" content="王小小友">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/bloghead.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/10/09/SpringBoot%E6%A0%B8%E5%BF%83/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot核心',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-09 21:58:03'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/bloghead.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/otherbackground.png')"><nav id="nav"><span id="blog-info"><a href="/" title="幸运的是遇见你"><span class="site-name">幸运的是遇见你</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot核心</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-09T13:56:49.000Z" title="发表于 2023-10-09 21:56:49">2023-10-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-09T13:58:03.260Z" title="更新于 2023-10-09 21:58:03">2023-10-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot核心"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SpringBoot核心"><a href="#SpringBoot核心" class="headerlink" title="SpringBoot核心"></a>SpringBoot核心</h1><hr>
<h3 id="一、配置文件"><a href="#一、配置文件" class="headerlink" title="一、配置文件"></a><strong>一、配置文件</strong></h3><h4 id="1-yaml"><a href="#1-yaml" class="headerlink" title="1.yaml"></a><strong>1.yaml</strong></h4><blockquote>
<p><strong>1.1 yaml简介</strong></p>
<p>YAML是“YAML Ain’t Markup Languge”（YAML不是一种标记语言）的递归缩写。在开发这种语言时，YAML意思其实是：“Yet Another Markup Language”（仍然是一种标记语言）。</p>
<p><strong>1.2 基本语法</strong></p>
<ul>
<li>key: value;kv之间有空格</li>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进不允许Tab，只允许空格</li>
<li>缩进的空格数不重要，只要相同的层级的元素左对齐即可</li>
<li>‘#’表示注释</li>
<li>‘’&#x2F;“”表示字符串内容，会被转义&#x2F;不转义</li>
</ul>
<p><strong>1.3  数据类型</strong></p>
<ul>
<li>字面量：单个的、不可再分的值。date、boolean、string、number、null</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">K:</span> <span class="string">v</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对象：键值对的集合。map、hash、set、object</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">行内写法：</span> <span class="attr">k:</span> &#123;<span class="string">k1:v1</span>,<span class="string">k2:v2</span>,<span class="string">K3:v3...</span>&#125;</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="attr">K:</span></span><br><span class="line">  <span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">K2:</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">K3:</span> <span class="string">v3</span></span><br><span class="line">  <span class="string">...</span></span><br></pre></td></tr></table></figure>

<ul>
<li>数组：一组按次序排列的值：array、list、queue</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">行内写法：</span> <span class="attr">k:</span> [<span class="string">v1</span>,<span class="string">v2</span>,<span class="string">v3...</span>]</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="attr">K:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">v3</span></span><br><span class="line">  <span class="string">...</span></span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
<h3 id="二、Web开发"><a href="#二、Web开发" class="headerlink" title="二、Web开发"></a>二、Web开发</h3><h4 id="1-SpringMVC自动配置概览"><a href="#1-SpringMVC自动配置概览" class="headerlink" title="1.SpringMVC自动配置概览"></a>1.SpringMVC自动配置概览</h4><h4 id="2-简单功能分析"><a href="#2-简单功能分析" class="headerlink" title="2.简单功能分析"></a>2.简单功能分析</h4><blockquote>
<p><strong>2.1 静态资源访问</strong></p>
<ul>
<li><p>静态资源目录</p>
<p>  <em>By default, Spring Boot serves static content from a directory called &#x3D;&#x3D;&#x2F;static&#x3D;&#x3D; (or  &#x3D;&#x3D;&#x2F;public&#x3D;&#x3D;  or &#x3D;&#x3D;&#x2F;resources&#x3D;&#x3D; or &#x3D;&#x3D;&#x2F;META-INF&#x2F;resources&#x3D;&#x3D;) in the classpath or from the root of the ServletContext.</em></p>
<p>  <em>by default, resources are mapped on &#x2F;**, but you can tune that with the &#x3D;&#x3D;spring.mvc.static-pathpattern&#x3D;&#x3D; property.</em><br>  默认情况下，springboot访问静态资源的映射是&#x2F;**，但可以使用 <code>spring.mvc.static-pathpattern </code>属性进行更改。</p>
<p>  <em>You can also customize the static resource locations by using the &#x3D;&#x3D;spring.web.resources.static-locations&#x3D;&#x3D; property (<strong>replacing the default values with a list of directory locations</strong>). The root Servlet context path, “&#x2F;“, is automatically added as a location as well.</em></p>
</li>
<li><p>支持webjars</p>
<p>  <a target="_blank" rel="noopener" href="https://www.webjars.org/">webjars官网</a></p>
</li>
</ul>
<p><strong>2.2 欢迎页与网站图标</strong></p>
<ul>
<li><p>欢迎页</p>
<p>  <em>Spring Boot supports both static and templated welcome pages. It first looks for an &#x3D;&#x3D;index.html&#x3D;&#x3D; file &#x3D;&#x3D;in the configured static content locations&#x3D;&#x3D;. If one is not found, it then looks for an &#x3D;&#x3D;index template&#x3D;&#x3D;. If either is found, it is &#x3D;&#x3D;automatically used as the welcome page&#x3D;&#x3D; of the application.</em></p>
</li>
<li><p>网站图标</p>
<p>  在静态资源目录下将要使用的网站图标名称改为favicon，springboot部分官方文档没有说明。</p>
</li>
</ul>
<p><strong>2.3 静态资源配置原理</strong></p>
<ul>
<li><p>SpringBoot启动默认加载xxxAutoConfiguration类(自动配置类)</p>
</li>
<li><p>springMVC功能的自动配置类 WebMvcAutoConfiguration</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta">    type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123;WebMvcConfigurationSupport.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(-2147483638)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123;DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">	proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Import(&#123;WebMvcAutoConfiguration.EnableWebMvcConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;WebMvcProperties.class, ResourceProperties.class, WebProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, ServletContextAware &#123;&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">	proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;WebProperties.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">ResourceLoaderAware</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>  <code>WebMvcAutoConfigurationAdapter</code>上注解了<code>@EnableConfigurationProperties(&#123;WebMvcProperties.class, ResourceProperties.class, WebProperties.class&#125;)</code>，可以知道三个类<code>WebMvcProperties</code>、<code>ResourceProperties</code>、<code>WebProperties</code>分别绑定了配置文件的信息，并且被注册到容器中。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WebMvcAutoConfigurationAdapter只有一个有参构造器，有参构造的参数值都会从容器中确定</span></span><br><span class="line"><span class="comment">//ResourceProperties resourceProperties | 获取和spring.resource绑定的对象</span></span><br><span class="line"><span class="comment">//WebProperties webProperties | 获取和spring.web绑定的对象</span></span><br><span class="line"><span class="comment">//WebMvcProperties mvcProperties | 获取和spring.mvc绑定的对象</span></span><br><span class="line"><span class="comment">//ListableBeanFactory beanFactory | spring的bean工厂</span></span><br><span class="line"><span class="comment">//HttpMessageConverters | 找到所有的HttpMessageConverters</span></span><br><span class="line"><span class="comment">//ResourceHandlerRegistrationCustomizer | 找到资源处理器的自定义器</span></span><br><span class="line"><span class="comment">//dispatcherServletPath | 前端控制器处理的路径</span></span><br><span class="line"><span class="comment">//ServletRegistrationBean | servlet注册bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WebMvcAutoConfigurationAdapter</span><span class="params">(ResourceProperties resourceProperties, </span></span><br><span class="line"><span class="params">                                      WebProperties webProperties, </span></span><br><span class="line"><span class="params">                                      WebMvcProperties mvcProperties, </span></span><br><span class="line"><span class="params">                                      ListableBeanFactory beanFactory, </span></span><br><span class="line"><span class="params">                                      ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span></span><br><span class="line"><span class="params">									  ObjectProvider&lt;WebMvcAutoConfiguration.ResourceHandlerRegistrationCustomizer&gt; 									  			resourceHandlerRegistrationCustomizerProvider,</span></span><br><span class="line"><span class="params">                                      ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span></span><br><span class="line"><span class="params">                                      ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> &#123;</span><br><span class="line">    		<span class="built_in">this</span>.resourceProperties = (Resources)(resourceProperties.hasBeenCustomized() ? resourceProperties : webProperties.getResources());</span><br><span class="line">            <span class="built_in">this</span>.mvcProperties = mvcProperties;</span><br><span class="line">            <span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">            <span class="built_in">this</span>.messageConvertersProvider = messageConvertersProvider;</span><br><span class="line">            <span class="built_in">this</span>.resourceHandlerRegistrationCustomizer = (WebMvcAutoConfiguration.ResourceHandlerRegistrationCustomizer)resourceHandlerRegistrationCustomizerProvider.getIfAvailable();</span><br><span class="line">            <span class="built_in">this</span>.dispatcherServletPath = dispatcherServletPath;</span><br><span class="line">            <span class="built_in">this</span>.servletRegistrations = servletRegistrations;</span><br><span class="line">            <span class="built_in">this</span>.mvcProperties.checkConfiguration();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <code>WebMvcAutoConfigurationAdapter</code>内部的处理资源方法</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, ServletContextAware &#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addResourceHandler</span><span class="params">(ResourceHandlerRegistry registry, String pattern, String... locations)</span> &#123;</span><br><span class="line">     	<span class="built_in">this</span>.addResourceHandler(registry, pattern, (registration) -&gt; &#123;</span><br><span class="line">     		registration.addResourceLocations(locations);</span><br><span class="line">     	&#125;);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addResourceHandler</span><span class="params">(ResourceHandlerRegistry registry, String pattern, 		 </span></span><br><span class="line"><span class="params">                                     Consumer&lt;ResourceHandlerRegistration&gt; customizer)</span></span><br><span class="line">     &#123;</span><br><span class="line">      <span class="keyword">if</span> (!registry.hasMappingForPattern(pattern)) &#123;</span><br><span class="line">      	<span class="type">ResourceHandlerRegistration</span> <span class="variable">registration</span> <span class="operator">=</span> registry.addResourceHandler(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;pattern&#125;);</span><br><span class="line">      	customizer.accept(registration);</span><br><span class="line">      	registration.setCachePeriod(<span class="built_in">this</span>.getSeconds(<span class="built_in">this</span>.resourceProperties.getCache().getPeriod()));</span><br><span class="line">      	registration.setCacheControl(<span class="built_in">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());</span><br><span class="line">      	registration.setUseLastModified(<span class="built_in">this</span>.resourceProperties.getCache().isUseLastModified());</span><br><span class="line">      	<span class="built_in">this</span>.customizeResourceHandlerRegistration(registration);</span><br><span class="line">      &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>2.4 请求参数处理</strong></p>
<ul>
<li><p>请求映射(REST)</p>
<p>  表单提交会带上<code>_method=GET/POST/PUT/DELETE</code>。</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;get&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">submit</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ************************ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;post&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">submit</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ************************ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">submit</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ************************ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">submit</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  在<code>WebMvcAutoConfiguration</code>中有处理<em>rest</em>风格的隐藏域过滤器。</p>
<p>  <code>springboot</code>中<em>rest</em>风格处理器在配置文件中选择性开启。</p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123;HiddenHttpMethodFilter.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">	prefix = &quot;spring.mvc.hiddenmethod.filter&quot;,</span></span><br><span class="line"><span class="meta">	name = &#123;&quot;enabled&quot;&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span> <span class="keyword">extends</span> <span class="title class_">HiddenHttpMethodFilter</span> <span class="keyword">implements</span> <span class="title class_">OrderedFilter</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiddenHttpMethodFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; ALLOWED_METHODS;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_METHOD_PARAM</span> <span class="operator">=</span> <span class="string">&quot;_method&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">methodParam</span> <span class="operator">=</span> <span class="string">&quot;_method&quot;</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain </span></span><br><span class="line"><span class="params">                                    filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">requestToUse</span> <span class="operator">=</span> request;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equals(request.getMethod()) &amp;&amp; request.getAttribute(<span class="string">&quot;javax.servlet.error.exception&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">paramValue</span> <span class="operator">=</span> request.getParameter(<span class="built_in">this</span>.methodParam);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasLength(paramValue)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> paramValue.toUpperCase(Locale.ENGLISH);</span><br><span class="line">                <span class="keyword">if</span> (ALLOWED_METHODS.contains(method)) &#123;</span><br><span class="line">                    requestToUse = <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>.HttpMethodRequestWrapper(request, method);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter((ServletRequest)requestToUse, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  通过<code>HiddenHttpMethodFilter</code>中的<code>doFilterInternal</code>方法获取到隐藏域中请求方式，并将请求上传到<code>ServletReuqestWrapper</code>.</p>
</li>
<li><p>请求映射原理</p>
<p>  <code>springboot</code>实现请求映射仍然是利用<code>springMVC</code>，而<code>springMVC</code>实现请求映射是从<code>DispatcherSevlet</code>开始，DispatcherServlet的继承体系如图。</p>
<p>  <img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-05-31_09-14-54.png"></p>
<p>  通过继承可以发现，<code>DispatcherServlet</code>继承了原生的<code>HttpServlet</code>，而原生的<code>HttpServlet</code>主要有<code>init()</code>、<code>service()</code>、<code>doGet()</code>、<code>doPost()</code>、<code>destroy()</code>方法。则需要重写<em>do</em>方法。而<code>DispatcherServlet</code>并没有重写，通过查找发现<code>FrameworkServlet</code>重写了<em>do</em>方法。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">FrameworkServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServletBean</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, </span><br><span class="line">    IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.processRequest(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, </span><br><span class="line">    IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.processRequest(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doPut</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, </span><br><span class="line">    IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.processRequest(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doDelete</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, </span><br><span class="line">    IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.processRequest(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  不难看出<code>FrameworkServlet</code>重写这些方法后最终都调用了<code>this.processRequest(request, response);</code>在<code>processRequest</code>方法中进行了一系列初始化工作后又调用了<code>this.doService(request,response);</code></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure>

<p>  发现在<code>FrameworkServlet</code>中该方法是抽象方法，所以可以知道<code>DispatcherServlet</code>需要重写该方法。在<code>DispatcherServlet</code>的<code>doService()</code>方法中对web容器进行了一系列初始化操作后调用了<code>doDispatch()</code>方法。</p>
<p>  <img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-05-31_09-36-53.png"></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">processedRequest</span> <span class="operator">=</span> request;</span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">multipartRequestParsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <code>springMVC</code>通过**<code>mapperHandler = this.getHandler(processedRequest);</code>**获取到处理请求的执行链。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="type">Iterator</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="built_in">this</span>.handlerMappings.iterator();</span><br><span class="line">		<span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">			<span class="type">HandlerMapping</span> <span class="variable">mapping</span> <span class="operator">=</span> (HandlerMapping)var2.next();</span><br><span class="line">			<span class="type">HandlerExecutionChain</span> <span class="variable">handler</span> <span class="operator">=</span> mapping.getHandler(request);</span><br><span class="line">			<span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> handler;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  <img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-05-31_10-03-25.png"></p>
<p>  通过<code>while</code>循环遍历寻找能够处请求的<code>HandlerMapping</code>，调用<code>HandlerMapping</code>中的<code>getHandler();</code>方法得到处理的<em>handler</em>。</p>
</li>
</ul>
</blockquote>
<h4 id="3-springMVC常用参数注解"><a href="#3-springMVC常用参数注解" class="headerlink" title="3.springMVC常用参数注解"></a>3.springMVC常用参数注解</h4><blockquote>
<p><strong>3.1 @PathVariable</strong></p>
<p><strong>3.2 @RequestHeader</strong></p>
<p><strong>3.3 @CookieValue</strong></p>
<p><strong>3.4 @RequestAttribute</strong></p>
<p><strong>3.5 @RequestBody</strong></p>
<p><strong>3.6 @MatrixVariable</strong></p>
<p><strong>3.7 @RequestParam</strong></p>
</blockquote>
<h4 id="4-注解参数获取-源码分析"><a href="#4-注解参数获取-源码分析" class="headerlink" title="4.注解参数获取__源码分析"></a>4.注解参数获取__源码分析</h4><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParamController</span>&#123;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">getCar</span><span class="params">(</span></span><br><span class="line"><span class="params">							<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">							<span class="meta">@PathVariable(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">							<span class="meta">@PathVariable</span> Map&lt;String,String&gt; pv,</span></span><br><span class="line"><span class="params">							<span class="meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,</span></span><br><span class="line"><span class="params">							<span class="meta">@RequestHeader</span> Map&lt;String,String&gt; headers,</span></span><br><span class="line"><span class="params">							<span class="meta">@RequestParam(&quot;age&quot;)</span> Integer age,</span></span><br><span class="line"><span class="params">							<span class="meta">@RequestParam(&quot;inters&quot;)</span> List&lt;String&gt; inters,</span></span><br><span class="line"><span class="params">							<span class="meta">@RequestParam</span> Map&lt;String,String&gt; params,</span></span><br><span class="line"><span class="params">							<span class="meta">@CookieValue(&quot;_ga&quot;)</span> String _ga,</span></span><br><span class="line"><span class="params">							<span class="meta">@CookieValue(&quot;_ga&quot;)</span> Cookie cookie</span></span><br><span class="line"><span class="params">                           )</span></span><br><span class="line">&#123;</span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;id&quot;</span>,id);</span><br><span class="line">...</span><br><span class="line">map.put(<span class="string">&quot;cookie&quot;</span>,cookie);</span><br><span class="line"><span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-01_10-52-30.png"></p>
<ul>
<li><code>HandlerMapping</code>中能找到处理请求的<code>Handler(Controller.method)</code></li>
<li>之后<code>DispatchServlet</code>为当前<code>mapperHandler</code>找到一个<code>HandlerAdapter</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerAdapter <span class="title function_">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.handlerAdapters != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Iterator</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="built_in">this</span>.handlerAdapters.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">                <span class="type">HandlerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> (HandlerAdapter)var2.next();</span><br><span class="line">                <span class="keyword">if</span> (adapter.supports(handler)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> adapter;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;No adapter for handler [&quot;</span> + handler + <span class="string">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-01_10-59-27.png"></p>
<ul>
<li>在<code>getHandlerAdapter</code>方法中会遍历默认在集合<code>handlerAdapters</code>中的四个<code>handlerAdapter</code>,经过<code>supports</code>方法判断返回了<code>RequestMappingHandlerAdapter</code>.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></pre></td></tr></table></figure>

<ul>
<li><p>开始执行处理请求的方法</p>
<p>  最终会跳转到<code>RequestMappingHandlerAdapter</code>中执行<code>handlerInternal();</code>方法,在方法内部又调用了<code>invokeHandlerMethod();</code>方法.</p>
<p>  <img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-01_11-17-55.png"></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">invokeHandlerMethod</span><span class="params">(HttpServletRequest request, HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response);</span><br><span class="line">        ModelAndView var15;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">WebDataBinderFactory</span> <span class="variable">binderFactory</span> <span class="operator">=</span> <span class="built_in">this</span>.getDataBinderFactory(handlerMethod);</span><br><span class="line">            <span class="type">ModelFactory</span> <span class="variable">modelFactory</span> <span class="operator">=</span> <span class="built_in">this</span>.getModelFactory(handlerMethod, binderFactory);</span><br><span class="line">            <span class="type">ServletInvocableHandlerMethod</span> <span class="variable">invocableMethod</span> <span class="operator">=</span> <span class="built_in">this</span>.createInvocableHandlerMethod(handlerMethod);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">                invocableMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.argumentResolvers);</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure>

<p>  <img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-01_11-24-48.png"></p>
<p>  判断参数解析器是否存在,参数解析器是一个ArrayList数组,size&#x3D;27.再调用可执行方法的<code>setHandlerMethodArgumentResolvers();</code>将参数解析器设置进去.</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HandlerMethodArgumentResolverComposite argumentResolvers;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HandlerMethodArgumentResolverComposite</span> <span class="keyword">implements</span> <span class="title class_">HandlerMethodArgumentResolver</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerMethodArgumentResolver</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span>;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer, NativeWebRequest  </span></span><br><span class="line"><span class="params">                           webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  设置好参数解析器后，在<code>invokeHandlerMethod</code>方法中又调用了<code>invocableMethod.invokeAndHandle();</code>对设置好参数解析器的方法执行和处理。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer, Object... providedArgs)</span> </span><br><span class="line">    <span class="keyword">throws</span> Exception </span><br><span class="line">	&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> <span class="built_in">this</span>.invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">        <span class="built_in">this</span>.setResponseStatus(webRequest);</span><br><span class="line">        <span class="keyword">if</span> (returnValue == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.isRequestNotModified(webRequest) || <span class="built_in">this</span>.getResponseStatus() != <span class="literal">null</span> || </span><br><span class="line">                mavContainer.isRequestHandled()) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">this</span>.disableContentCachingIfNecessary(webRequest);</span><br><span class="line">                mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.getResponseStatusReason())) &#123;</span><br><span class="line">            mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mavContainer.setRequestHandled(<span class="literal">false</span>);</span><br><span class="line">        Assert.state(<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>, <span class="string">&quot;No return value handlers&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.returnValueHandlers.handleReturnValue(returnValue, <span class="built_in">this</span>.getReturnValueType(returnValue), </span><br><span class="line">                                                       mavContainer, webRequest);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var6) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">                logger.trace(<span class="built_in">this</span>.formatErrorForReturnValue(returnValue), var6);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> var6;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>  在方法<code>invokeAndHandle</code>中的第一行语句体中调用了<code>invokeForRequest</code>方法。执行对请求的处理。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invokeForRequest</span><span class="params">(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer, Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Object[] args = <span class="built_in">this</span>.getMethodArgumentValues(request, mavContainer, providedArgs);</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">&quot;Arguments: &quot;</span> + Arrays.toString(args));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.doInvoke(args);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>  在方法<code>invokeForRequest</code>中又调用了<code>getMethodArgumentValues</code>方法获取可执行处理方法的参数，并封装成一个<em>object</em>数组。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer, Object... providedArgs) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        MethodParameter[] parameters = <span class="built_in">this</span>.getMethodParameters();</span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;</span><br><span class="line">            <span class="keyword">return</span> EMPTY_ARGS;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; ++i) &#123;</span><br><span class="line">                <span class="type">MethodParameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">                parameter.initParameterNameDiscovery(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line">                args[i] = findProvidedArgument(parameter, providedArgs);</span><br><span class="line">                <span class="keyword">if</span> (args[i] == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="built_in">this</span>.resolvers.supportsParameter(parameter)) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="string">&quot;No suitable resolver&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        args[i] = <span class="built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="built_in">this</span>.dataBinderFactory);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception var10) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">exMsg</span> <span class="operator">=</span> var10.getMessage();</span><br><span class="line">                            <span class="keyword">if</span> (exMsg != <span class="literal">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;</span><br><span class="line">                                logger.debug(formatArgumentError(parameter, exMsg));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">throw</span> var10;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> args;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>  在代码的13行判断时调用了<code>supportsParamter();</code></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getArgumentResolver(parameter) != <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> HandlerMethodArgumentResolver <span class="title function_">getArgumentResolver</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">        <span class="type">HandlerMethodArgumentResolver</span> <span class="variable">result</span> <span class="operator">=</span> (HandlerMethodArgumentResolver)<span class="built_in">this</span>.argumentResolverCache.get(parameter);</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Iterator</span> <span class="variable">var3</span> <span class="operator">=</span> <span class="built_in">this</span>.argumentResolvers.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span class="line">                <span class="type">HandlerMethodArgumentResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> (HandlerMethodArgumentResolver)var3.next();</span><br><span class="line">                <span class="keyword">if</span> (resolver.supportsParameter(parameter)) &#123;</span><br><span class="line">                    result = resolver;</span><br><span class="line">                    <span class="built_in">this</span>.argumentResolverCache.put(parameter, resolver);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
<h4 id="5-复杂参数-源码分析"><a href="#5-复杂参数-源码分析" class="headerlink" title="5.复杂参数__源码分析"></a>5.复杂参数__源码分析</h4><blockquote>
<ul>
<li>对<em>Map、Model、HttpServletRequest</em>操作都可以给<em>request</em>域中放数据，三者分别调用的方法是<em>put、addAttribute、setAttribute.</em></li>
<li>目标方法执行完成数据都放在ModelAndViewContainer;包含要去的页面地址View。还包含Model数据。</li>
</ul>
</blockquote>
<h4 id="6-自定义对象获取-源码分析"><a href="#6-自定义对象获取-源码分析" class="headerlink" title="6.自定义对象获取_源码分析"></a>6.自定义对象获取_源码分析</h4><blockquote>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-02_10-23-01.png"></p>
<ul>
<li>自定义的参数pojo使用<code>ServletModelAttributeMethodProcessor</code>解析.</li>
<li>在<code>ModelAttributeMethodProcessor</code>类中。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer, NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Assert.state(mavContainer != <span class="literal">null</span>, <span class="string">&quot;ModelAttributeMethodProcessor requires ModelAndViewContainer&quot;</span>);</span><br><span class="line">        Assert.state(binderFactory != <span class="literal">null</span>, <span class="string">&quot;ModelAttributeMethodProcessor requires WebDataBinderFactory&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> ModelFactory.getNameForParameter(parameter);</span><br><span class="line">        <span class="type">ModelAttribute</span> <span class="variable">ann</span> <span class="operator">=</span> (ModelAttribute)parameter.getParameterAnnotation(ModelAttribute.class);</span><br><span class="line">        <span class="keyword">if</span> (ann != <span class="literal">null</span>) &#123;</span><br><span class="line">            mavContainer.setBinding(name, ann.binding());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">attribute</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (mavContainer.containsAttribute(name)) &#123;</span><br><span class="line">            attribute = mavContainer.getModel().get(name);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                attribute = <span class="built_in">this</span>.createAttribute(name, parameter, binderFactory, webRequest);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (BindException var10) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.isBindExceptionRequired(parameter)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> var10;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (parameter.getParameterType() == Optional.class) &#123;</span><br><span class="line">                    attribute = Optional.empty();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    attribute = var10.getTarget();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                bindingResult = var10.getBindingResult();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bindingResult == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">WebDataBinder</span> <span class="variable">binder</span> <span class="operator">=</span> binderFactory.createBinder(webRequest, attribute, name);</span><br><span class="line">            <span class="keyword">if</span> (binder.getTarget() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!mavContainer.isBindingDisabled(name)) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.bindRequestParameters(binder, webRequest);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">this</span>.validateIfApplicable(binder, parameter);</span><br><span class="line">                <span class="keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; <span class="built_in">this</span>.isBindExceptionRequired(binder, parameter)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BindException</span>(binder.getBindingResult());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!parameter.getParameterType().isInstance(attribute)) &#123;</span><br><span class="line">                attribute = binder.convertIfNecessary(binder.getTarget(), parameter.getParameterType(), parameter);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            bindingResult = binder.getBindingResult();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; bindingResultModel = bindingResult.getModel();</span><br><span class="line">        mavContainer.removeAttributes(bindingResultModel);</span><br><span class="line">        mavContainer.addAllAttributes(bindingResultModel);</span><br><span class="line">        <span class="keyword">return</span> attribute;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在33行代码中<code>WebDataBinder binder = binderFactory.createBinder(webRequest, attribute, name);</code><em>webReques</em>t是原生的<em>servlet</em>请求，<em>attribute</em>是容器用反射创建的自定义参数对象，<em>WebDataBinder</em>将请求参数的值绑定到指定<em>JavaBean</em>中。</li>
<li><em>WebDataBinder</em>利用它里面的<em>Converters</em>将请求转成指定的数据类型，再次封装到JavaBean中。</li>
</ul>
</blockquote>
<h4 id="8-视图解析与模板引擎"><a href="#8-视图解析与模板引擎" class="headerlink" title="8.视图解析与模板引擎"></a>8.视图解析与模板引擎</h4><p>springBoot默认不支持jsp，需要引入第三方模板引擎技术实现页面渲染。</p>
<blockquote>
<p><strong>8.1 视图解析</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(视图处理方式)--&gt;B1[转发]</span><br><span class="line">A(视图处理方式)--&gt;B2[重定向]</span><br><span class="line">A(视图处理方式)--&gt;B3[自定义视图]</span><br></pre></td></tr></table></figure>

<p><strong>8.2 Thymeleaf模板引擎</strong></p>
<ul>
<li><p>基本语法</p>
<table>
<thead>
<tr>
<th>表达式名字</th>
<th>语法</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>变量取值</td>
<td>${…}</td>
<td>获取请求域、session域、application域、对象等数据</td>
</tr>
<tr>
<td>选择变量</td>
<td>*{…}</td>
<td>获取上下文对象值</td>
</tr>
<tr>
<td>消息</td>
<td>#{…}</td>
<td>获取国际化等值</td>
</tr>
<tr>
<td>链接</td>
<td>@{…}</td>
<td>生成链接</td>
</tr>
<tr>
<td>片段表达式</td>
<td>~{…}</td>
<td>jsp:include作用，引入公共页面</td>
</tr>
</tbody></table>
</li>
<li><p><em>springboot</em>中<em>thymeleaf</em>使用</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>自动配置好的<em>thymeleaf</em></p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;ThymeleafProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;TemplateMode.class, SpringTemplateEngine.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123;WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;ReactiveTemplateEngineConfiguration.class, DefaultTemplateEngineConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafAutoConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>  所有的<code>thymeleaf</code>的配置都在<code>ThymeleafProperties</code>中；配置好了<code>SpringTemplateEngine</code>；配置好了<code>ThymeleafViewResolver</code>；只需直接页面开发。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_SUFFIX</span> <span class="operator">=</span> <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>开发<em>thymeleaf</em>页面</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  引入了<code>thymeleaf</code>的命名空间：<code>xmlns:th=&quot;http://www.thymeleaf.org&quot;</code>。</p>
</li>
</ul>
<h4 id="8-3-模板解析-源码分析"><a href="#8-3-模板解析-源码分析" class="headerlink" title="8.3 模板解析__源码分析"></a>8.3 模板解析__源码分析</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer, Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> <span class="built_in">this</span>.invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">    ...</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.returnValueHandlers.handleReturnValue(returnValue, <span class="built_in">this</span>.getReturnValueType(returnValue), mavContainer, </span><br><span class="line">                                                   webRequest);</span><br><span class="line">        &#125;<span class="keyword">catch</span>&#123;&#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在执行和处理请求后得到执行的结果<em>returnValue</em>，通过<code>returnValueHandlers.handleReturnValue();</code>方法处理返回值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType, ModelAndViewContainer </span></span><br><span class="line"><span class="params">                              mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HandlerMethodReturnValueHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="built_in">this</span>.selectHandler(returnValue, returnType);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName());</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<em>handleReturnValue</em>中调用了<code>selectHandler();</code>方法选择返回值处理器，如果返回值是<em>String</em>，会返回<em>ViewNameMethodReturnValueHandler;</em></p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-04_10-05-31.png"></p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-04_10-07-49.png"></p>
<p>返回返回值处理器后，返回值处理器调用<code>handleReturnValue();</code>方法处理返回值，内部详细流程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType, ModelAndViewContainer </span></span><br><span class="line"><span class="params">                              mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (returnValue <span class="keyword">instanceof</span> CharSequence) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> returnValue.toString();</span><br><span class="line">            mavContainer.setViewName(viewName);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.isRedirectViewName(viewName)) &#123;</span><br><span class="line">                mavContainer.setRedirectModelScenario(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (returnValue != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;Unexpected return type: &quot;</span> + returnType.getParameterType().getName() + <span class="string">&quot; in method: &quot;</span> + returnType.getMethod());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>所有数据放在<em>ModelAndViewContainer</em>中，包括数据和视图地址,处理完后在DispatchSevlet中最终处理派发结果代码,决定页面如何响应：<br><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-04_10-18-29.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processDispatchResult</span><span class="params">(HttpServletRequest request, HttpServletResponse response, <span class="meta">@Nullable</span> </span></span><br><span class="line"><span class="params">                                   HandlerExecutionChain mappedHandler, <span class="meta">@Nullable</span> ModelAndView mv, <span class="meta">@Nullable</span> Exception </span></span><br><span class="line"><span class="params">                                   exception)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">errorView</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (exception != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ModelAndViewDefiningException) &#123;</span><br><span class="line">                <span class="built_in">this</span>.logger.debug(<span class="string">&quot;ModelAndViewDefiningException encountered&quot;</span>, exception);</span><br><span class="line">                mv = ((ModelAndViewDefiningException)exception).getModelAndView();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> mappedHandler != <span class="literal">null</span> ? mappedHandler.getHandler() : <span class="literal">null</span>;</span><br><span class="line">                mv = <span class="built_in">this</span>.processHandlerException(request, response, handler, exception);</span><br><span class="line">                errorView = mv != <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mv != <span class="literal">null</span> &amp;&amp; !mv.wasCleared()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.render(mv, request, response);</span><br><span class="line">            <span class="keyword">if</span> (errorView) &#123;</span><br><span class="line">                WebUtils.clearErrorRequestAttributes(request);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.trace(<span class="string">&quot;No view rendering, null ModelAndView returned.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mappedHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                mappedHandler.triggerAfterCompletion(request, response, (Exception)<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>processDispatcherResult();</code>方法中又调用了<code>this.render(mv, request, response);</code>方法渲染页面。在<em>render</em>里面的获取视图的逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">(ModelAndView mv, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span> <span class="built_in">this</span>.localeResolver != <span class="literal">null</span> ? <span class="built_in">this</span>.localeResolver.resolveLocale(request) : request.getLocale();</span><br><span class="line">        response.setLocale(locale);</span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> mv.getViewName();</span><br><span class="line">        View view;</span><br><span class="line">        <span class="keyword">if</span> (viewName != <span class="literal">null</span>) &#123;</span><br><span class="line">            view = <span class="built_in">this</span>.resolveViewName(viewName, mv.getModelInternal(), locale, request);</span><br><span class="line">            <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;Could not resolve view with name &#x27;&quot;</span> + mv.getViewName() + <span class="string">&quot;&#x27; in servlet with </span></span><br><span class="line"><span class="string">                                           name &#x27;&quot;</span> + <span class="built_in">this</span>.getServletName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view = mv.getView();</span><br><span class="line">            <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;ModelAndView [&quot;</span> + mv + <span class="string">&quot;] neither contains a view name nor a View object in </span></span><br><span class="line"><span class="string">                                           servlet with name &#x27;&quot;</span> + <span class="built_in">this</span>.getServletName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过返回的<em>modelAndView</em>传入到参数中获取视图名，调用<code>resolveViewName();</code>方法返回视图。</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-04_14-59-46.png"></p>
<p>对<em>ViewResolvers</em>中已存在的5个视图解析器进行遍历，判断是否能够解析，能够解析就解析返回<em>View</em>。</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-04_15-05-39.png"></p>
<p>如何判断是否能够解析，是通过遍历出来的<em>ViewResolver</em>调用自己的<code>resolveViewName();</code>方法实现的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> View <span class="title function_">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">RequestAttributes</span> <span class="variable">attrs</span> <span class="operator">=</span> RequestContextHolder.getRequestAttributes();</span><br><span class="line">        Assert.state(attrs <span class="keyword">instanceof</span> ServletRequestAttributes, <span class="string">&quot;No current ServletRequestAttributes&quot;</span>);</span><br><span class="line">        List&lt;MediaType&gt; requestedMediaTypes = <span class="built_in">this</span>.getMediaTypes(((ServletRequestAttributes)attrs).getRequest());</span><br><span class="line">        <span class="keyword">if</span> (requestedMediaTypes != <span class="literal">null</span>) &#123;</span><br><span class="line">            List&lt;View&gt; candidateViews = <span class="built_in">this</span>.getCandidateViews(viewName, locale, requestedMediaTypes);</span><br><span class="line">            <span class="type">View</span> <span class="variable">bestView</span> <span class="operator">=</span> <span class="built_in">this</span>.getBestView(candidateViews, requestedMediaTypes, attrs);</span><br><span class="line">            <span class="keyword">if</span> (bestView != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> bestView;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>resolveViewName();</code>中，获取了候选视图的集合，通过调用<code>getBestView();</code>方法将候选视图视为参数传入，获得处理的最佳视图。在获取最佳候选视图时，内部又调用了视图的遍历。</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-04_15-25-09.png"></p>
</blockquote>
<h4 id="9-拦截器-Intercepter"><a href="#9-拦截器-Intercepter" class="headerlink" title="9.拦截器(Intercepter)"></a>9.拦截器(Intercepter)</h4><blockquote>
<ul>
<li>拦截器根据当前请求，找到HandlerExecutionChain[可以处理请求的handler以及handler的所有拦截器]</li>
<li>先来顺序执行所有拦截器的preHandle方法<ul>
<li>1、如果当前拦截器preHandler返回为true，则执行下一个拦截器的preHandler</li>
<li>2、如果当前拦截返回为false。会倒序执行已经执行了的拦截器afterCompletion；</li>
</ul>
</li>
<li>如果任何一个拦截器返回false，直接跳出不执行目标方法</li>
<li>如果都返回true，执行目标方法</li>
<li>倒序执行postHandler</li>
</ul>
</blockquote>
<h4 id="10-文件上传-MultipartFile"><a href="#10-文件上传-MultipartFile" class="headerlink" title="10.文件上传(MultipartFile)"></a>10.文件上传(MultipartFile)</h4><blockquote>
<p><strong>10.1 文件上传代码</strong></p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-04_19-20-24.png"></p>
</blockquote>
<h4 id="11-错误处理机制"><a href="#11-错误处理机制" class="headerlink" title="11.错误处理机制"></a>11.错误处理机制</h4><blockquote>
<p><strong>11.1 错误处理</strong></p>
<ul>
<li>默认情况下Spring Boot提供&#x2F;error处理所有错误的映射</li>
<li>对于机器客户端，它将生成JSON响应，其中包含错误、HTTP响应状态和异常详细信息。对于浏览器端响应“whitelabel”错误视图，以HTML格式呈现相同数据。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-06-05T00:47:14.984+00:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">404</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Not Found&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;No message available&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/safdsaf&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>要对其进行自定义，添加View解析为error</li>
<li>要完全替换默认行为，可以实现ErrorController并注册该类的Bean定义，或添加ErrorAttributes类型的组件以使用现有机制替换其内容</li>
<li>error下的4xx，5xx页面会自动解析<ul>
<li><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-05_08-56-19.png"></li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="12-Web原生组件注入"><a href="#12-Web原生组件注入" class="headerlink" title="12.Web原生组件注入"></a>12.Web原生组件注入</h4><blockquote>
<p><strong>12.1 使用servlet API</strong></p>
<ul>
<li>@ServletComponentScan</li>
<li>@WebServlet</li>
<li>@WebFilter</li>
<li>@WebListener</li>
</ul>
<p><strong>12.2 向容器中注入ServletRegistrationBean、FilterRegistrationBean、ServletListenerRegistrationBean组件</strong></p>
<p><strong>12.3 DispatcherServlet注入原理</strong></p>
<p>在springboot的自动注入配置中DispatcherServletAutoConfiguration有两个静态内部类.一个是DispatcherServletRegistrationConfiguration。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">        proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line"><span class="meta">@Conditional(&#123;DispatcherServletAutoConfiguration.DispatcherServletRegistrationCondition.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;ServletRegistration.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;WebMvcProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;DispatcherServletAutoConfiguration.DispatcherServletConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DispatcherServletRegistrationConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该内部有一个方法配置了注册信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(</span></span><br><span class="line"><span class="meta">      name = &#123;&quot;dispatcherServletRegistration&quot;&#125;</span></span><br><span class="line"><span class="meta">      )</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(</span></span><br><span class="line"><span class="meta">      value = &#123;DispatcherServlet.class&#125;,</span></span><br><span class="line"><span class="meta">      name = &#123;&quot;dispatcherServlet&quot;&#125;</span></span><br><span class="line"><span class="meta">      )</span></span><br><span class="line"><span class="keyword">public</span> DispatcherServletRegistrationBean <span class="title function_">dispatcherServletRegistration</span><span class="params">(DispatcherServlet dispatcherServlet, </span></span><br><span class="line"><span class="params">                                                                       WebMvcProperties webMvcProperties, </span></span><br><span class="line"><span class="params">                                                                     ObjectProvider&lt;MultipartConfigElement&gt; </span></span><br><span class="line"><span class="params">                                                                       multipartConfig)</span> &#123;</span><br><span class="line">     <span class="type">DispatcherServletRegistrationBean</span> <span class="variable">registration</span> <span class="operator">=</span> <span class="keyword">new</span> </span><br><span class="line">         <span class="title class_">DispatcherServletRegistrationBean</span>(dispatcherServlet, webMvcProperties.getServlet().getPath());</span><br><span class="line">     registration.setName(<span class="string">&quot;dispatcherServlet&quot;</span>);</span><br><span class="line">     registration.setLoadOnStartup(webMvcProperties.getServlet().getLoadOnStartup());</span><br><span class="line">     multipartConfig.ifAvailable(registration::setMultipartConfig);</span><br><span class="line">     <span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一个是DispatcherServletConfiguration</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">        proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line"><span class="meta">@Conditional(&#123;DispatcherServletAutoConfiguration.DefaultDispatcherServletCondition.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;ServletRegistration.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;WebMvcProperties.class&#125;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DispatcherServletConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>该类设置了DispatcherServlet初始化信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(</span></span><br><span class="line"><span class="meta">            name = &#123;&quot;dispatcherServlet&quot;&#125;</span></span><br><span class="line"><span class="meta">      )</span></span><br><span class="line"><span class="keyword">public</span> DispatcherServlet <span class="title function_">dispatcherServlet</span><span class="params">(WebMvcProperties webMvcProperties)</span> &#123;</span><br><span class="line">     <span class="type">DispatcherServlet</span> <span class="variable">dispatcherServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DispatcherServlet</span>();</span><br><span class="line">     dispatcherServlet.setDispatchOptionsRequest(webMvcProperties.isDispatchOptionsRequest());</span><br><span class="line">     dispatcherServlet.setDispatchTraceRequest(webMvcProperties.isDispatchTraceRequest());</span><br><span class="line">   dispatcherServlet.setThrowExceptionIfNoHandlerFound(webMvcProperties.isThrowExceptionIfNoHandlerFound());</span><br><span class="line">     dispatcherServlet.setPublishEvents(webMvcProperties.isPublishRequestHandledEvents());</span><br><span class="line">     dispatcherServlet.setEnableLoggingRequestDetails(webMvcProperties.isLogRequestDetails());</span><br><span class="line">     <span class="keyword">return</span> dispatcherServlet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="13-嵌入式Servlet容器-源码分析-切换web服务器与定制化"><a href="#13-嵌入式Servlet容器-源码分析-切换web服务器与定制化" class="headerlink" title="13.嵌入式Servlet容器_源码分析(切换web服务器与定制化)"></a>13.嵌入式Servlet容器_源码分析(切换web服务器与定制化)</h4><blockquote>
<p><em>Spring Boot includes support for &#x3D;&#x3D;embedded Tomcat, Jetty, and Undertow servers&#x3D;&#x3D;. Most developers use the appropriate “Starter” to obtain a fully configured instance. By default, the embedded server listens for HTTP requests on port 8080.</em></p>
<p>Under the hood, Spring Boot uses a different type of ApplicationContext for embedded servlet container support. The &#x3D;&#x3D;ServletWebServerApplicationContext is a special type of WebApplicationContext&#x3D;&#x3D; that bootstraps itself by searching for a single ServletWebServerFactory bean. &#x3D;&#x3D;Usually a TomcatServletWebServerFactory, JettyServletWebServerFactory, or UndertowServletWebServerFactory has been auto-configured&#x3D;&#x3D;.</p>
<p>springBoot在web服务启动时会寻找web服务器工厂，springBoot默认配置了tomcat、jetty和undertow三个web服务器工厂。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(-2147483648)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;ServletRequest.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta"> type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;ServerProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class, EmbeddedTomcat.class, EmbeddedJetty.class, EmbeddedUndertow.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletWebServerFactoryAutoConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>类ServletWebServerFactoryAutoConfiguration上标注了注解Import可以知道向容器中导入了&#x3D;&#x3D;EmbeddedTomcat.class&#x3D;&#x3D;、&#x3D;&#x3D;EmbeddedJetty.class&#x3D;&#x3D;、&#x3D;&#x3D;EmbeddedUndertow.class&#x3D;&#x3D;。也印证了springBoot默认配置的三个web服务器工厂。</p>
<p>EmbeddedTomcat、EmbeddedJetty、EmbeddedUndertow是ServletWebServerFactoryConfiguration的静态内部类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta"> proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServletWebServerFactoryConfiguration</span> &#123;</span><br><span class="line"> <span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">     proxyBeanMethods = false</span></span><br><span class="line"><span class="meta"> )</span></span><br><span class="line"> <span class="meta">@ConditionalOnClass(&#123;Servlet.class, Undertow.class, SslClientAuthMode.class&#125;)</span></span><br><span class="line"> <span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">     value = &#123;ServletWebServerFactory.class&#125;,</span></span><br><span class="line"><span class="meta">     search = SearchStrategy.CURRENT</span></span><br><span class="line"><span class="meta"> )</span></span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedUndertow</span> &#123;...&#125;</span><br><span class="line"> <span class="comment">//----------------------------------------------------------------------------</span></span><br><span class="line"> <span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">     proxyBeanMethods = false</span></span><br><span class="line"><span class="meta"> )</span></span><br><span class="line"> <span class="meta">@ConditionalOnClass(&#123;Servlet.class, Server.class, Loader.class, WebAppContext.class&#125;)</span></span><br><span class="line"> <span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">     value = &#123;ServletWebServerFactory.class&#125;,</span></span><br><span class="line"><span class="meta">     search = SearchStrategy.CURRENT</span></span><br><span class="line"><span class="meta"> )</span></span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedJetty</span> &#123;...&#125;</span><br><span class="line"> <span class="comment">//----------------------------------------------------------------------------</span></span><br><span class="line"> <span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">     proxyBeanMethods = false</span></span><br><span class="line"><span class="meta"> )</span></span><br><span class="line"> <span class="meta">@ConditionalOnClass(&#123;Servlet.class, Tomcat.class, UpgradeProtocol.class&#125;)</span></span><br><span class="line"> <span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">     value = &#123;ServletWebServerFactory.class&#125;,</span></span><br><span class="line"><span class="meta">     search = SearchStrategy.CURRENT</span></span><br><span class="line"><span class="meta"> )</span></span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedTomcat</span> &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认web-starter导入tomcat包，所以容器中会有TomcatServletWebServerFactory。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedTomcat</span> &#123;</span><br><span class="line">     EmbeddedTomcat() &#123;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     TomcatServletWebServerFactory <span class="title function_">tomcatServletWebServerFactory</span><span class="params">(ObjectProvider&lt;TomcatConnectorCustomizer&gt; connectorCustomizers, ObjectProvider&lt;TomcatContextCustomizer&gt; contextCustomizers, ObjectProvider&lt;TomcatProtocolHandlerCustomizer&lt;?&gt;&gt; protocolHandlerCustomizers)</span> &#123;</span><br><span class="line">         <span class="type">TomcatServletWebServerFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TomcatServletWebServerFactory</span>();                       		 factory.getTomcatConnectorCustomizers().addAll((Collection)connectorCustomizers.orderedStream().collect(Co</span><br><span class="line">         llectors.toList()));</span><br><span class="line">        factory.getTomcatContextCustomizers().addAll((Collection)contextCustomizers.orderedStream().collect(Collectors.toList()));</span><br><span class="line">         factory.getTomcatProtocolHandlerCustomizers().addAll((Collection)protocolHandlerCustomizers.orderedStream().collect(Collectors.toList()));</span><br><span class="line">         <span class="keyword">return</span> factory;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>通过TomcatServletWebServerFactory创建出tomcat容器并启动服务器。</p>
<ul>
<li>切换web服务器，spring-web-starter默认的web服务器是tomcat，要切换服务器需要在pom.xml文件下做如下修改</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-xxx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--xxx可以是jetty或undertow或其他--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>配置服务器的相关参数</p>
<p>  通过·配置文件下的server.xxx。<br>  直接自定义ConfigurationServletWebServerFactory。</p>
</li>
</ul>
</blockquote>
<h4 id="14-定制化原理套路"><a href="#14-定制化原理套路" class="headerlink" title="14.定制化原理套路"></a>14.定制化原理套路</h4><blockquote>
<p>&#x3D;&#x3D;场景starter&#x3D;&#x3D;-xxxAutoConfiguration-导入xxx组件-绑定xxxProperties-&#x3D;&#x3D;绑定配置文件&#x3D;&#x3D;。</p>
<ul>
<li><p>定制化常见方式</p>
<ul>
<li><p>修改配置文件</p>
</li>
<li><p>编写自定义的配置类xxxConfiguration；+@Bean替换、增加容器中默认组件；视图解析器。</p>
</li>
<li><p>web应用实现WebMvcConfigurer即可实现定制化web功能。</p>
<ul>
<li><pre><code class="java">  @Configuration
  public class SpringConfig implements WebMvcConfigurer &#123;
      @Override
      public void addInterceptors(InterceptorRegistry registry) &#123;
          registry.addInterceptor(new LoginInterceptor()).addPathPatterns(&quot;/**&quot;).excludePathPatterns(&quot;/&quot;,&quot;/index&quot;,&quot;/css/**&quot;,&quot;/js/**&quot;,&quot;/fonts/**&quot;,&quot;/images/**&quot;,&quot;/login&quot;);
      &#125;
  &#125;
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 三、数据访问</span><br><span class="line"></span><br><span class="line">#### 1.SQL</span><br><span class="line"></span><br><span class="line">**1.1 数据源的自动配置**</span><br><span class="line"></span><br><span class="line">- 导入JDBC场景</span><br><span class="line"></span><br><span class="line">	```xml</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">	    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	    &lt;artifactId&gt;spring-boot-starter-data-jdbc&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>  <img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-05_16-38-27.png"></p>
</li>
</ul>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-05_21-40-58.png"></p>
<ul>
<li>JDBC自动导入许多配置类，而数据源自动配置主要在DataSourceAutoConfiguration中.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(</span></span><br><span class="line"><span class="meta">    before = &#123;SqlInitializationAutoConfiguration.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;DataSource.class, EmbeddedDatabaseType.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">    type = &#123;&quot;io.r2dbc.spi.ConnectionFactory&quot;&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;DataSourceProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;DataSourcePoolMetadataProvidersConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAutoConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="2-druid数据源starter整合"><a href="#2-druid数据源starter整合" class="headerlink" title="2.druid数据源starter整合"></a>2.druid数据源starter整合</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">参照github中alibaba的官方文档</a></p>
<p>在项目的pom.xml中导入druid场景启动器。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个场景启动器给项目导入了如下依赖：</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-06_08-56-59.png"></p>
<p>很显然它导入了springboot的自动配置包，利用了springboot自动配置的特性。在依赖目录中：</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-06_08-59-18.png"></p>
<p>有druid的数据源自动配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;DruidDataSource.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureBefore(&#123;DataSourceAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;DruidStatProperties.class, DataSourceProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;DruidSpringAopConfiguration.class, DruidStatViewServletConfiguration.class, DruidWebStatFilterConfiguration.class, DruidFilterConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidDataSourceAutoConfigure</span> &#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(DruidDataSourceAutoConfigure.class);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="title function_">DruidDataSourceAutoConfigure</span><span class="params">()</span> &#123;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean(</span></span><br><span class="line"><span class="meta">     initMethod = &quot;init&quot;</span></span><br><span class="line"><span class="meta"> )</span></span><br><span class="line"> <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"> <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">     LOGGER.info(<span class="string">&quot;Init DruidDataSource&quot;</span>);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSourceWrapper</span>();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在druid数据源的自动配置类中，绑定了配置类DruidStatProperties.class(spring.datasource.druid)和 DataSourceProperties.class(spring.datasource)，还导入了组件</p>
<ul>
<li>DruidSpringAopConfiguration.class：监控SpringBean的，配置项spring.datasource.druid.aop-patterns</li>
<li>DruidStatViewServletConfiguration.class：监控页的配置spring.datasource.druid.stat-view-servlet</li>
<li>DruidWebStatFilterConfiguration.class：web监控配置spring.datasource.druid.web-stat-filter</li>
<li>DruidFilterConfiguration.class：所有的druid自己的filter配置</li>
</ul>
</blockquote>
<h4 id="3-整合mybatis"><a href="#3-整合mybatis" class="headerlink" title="3.整合mybatis"></a>3.整合mybatis</h4><p><a target="_blank" rel="noopener" href="https://github.com/mybatis">mybatis   github官方整合文档</a></p>
<blockquote>
<p>引入mybatis的场景启动器。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个场景启动器给项目引入了如下依赖。</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-06_09-36-27.png"></p>
<p>很显然它导入了springboot的自动配置包，利用了springboot自动配置的特性。在依赖目录中：</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-06_09-39-27.png"></p>
<p>有mybatis的自动配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;SqlSessionFactory.class, SqlSessionFactoryBean.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(DataSource.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;MybatisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123;DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisAutoConfiguration</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>在mybatis的自动配置类中绑定了配置类MybatisProperties.class。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta"> prefix = &quot;mybatis&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisProperties</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MYBATIS_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;mybatis&quot;</span>;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ResourcePatternResolver</span> <span class="variable">resourceResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line"> <span class="keyword">private</span> String configLocation;</span><br><span class="line"> <span class="keyword">private</span> String[] mapperLocations;</span><br><span class="line"> <span class="keyword">private</span> String typeAliasesPackage;</span><br><span class="line"> <span class="keyword">private</span> Class&lt;?&gt; typeAliasesSuperType;</span><br><span class="line"> <span class="keyword">private</span> String typeHandlersPackage;</span><br><span class="line"> <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">checkConfigLocation</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"> <span class="keyword">private</span> ExecutorType executorType;</span><br><span class="line"> <span class="keyword">private</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">LanguageDriver</span>&gt; defaultScriptingLanguageDriver;</span><br><span class="line"> <span class="keyword">private</span> Properties configurationProperties;</span><br><span class="line"> <span class="meta">@NestedConfigurationProperty</span></span><br><span class="line"> <span class="keyword">private</span> Configuration configuration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个配置类中(代码的17行)，又有一个配置configuration，mybatis全局配置项可以通过mybatis.configuration修改.</p>
</blockquote>
<h4 id="4-整合mybatis-plus"><a href="#4-整合mybatis-plus" class="headerlink" title="4.整合mybatis-plus"></a>4.整合mybatis-plus</h4><p><a target="_blank" rel="noopener" href="https://baomidou.com/">mybatis-plus官方文档</a></p>
<blockquote>
<p>引入mybatis-plus场景</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>最新版本<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个场景启动器引入了如下依赖</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-06_16-49-02.png"></p>
<p>同样的它导入了springboot的自动配置包，有自动配置特性，同时它引入了jdbc的场景启动器。依赖目录</p>
<p><img src="C:/Users/王友/Pictures/springboot/Snipaste_2023-06-06_16-51-13.png"></p>
<p>有mybatis-plus自动配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;SqlSessionFactory.class, SqlSessionFactoryBean.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(DataSource.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;MybatisPlusProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123;DataSourceAutoConfiguration.class, MybatisPlusLanguageDriverAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusAutoConfiguration</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>在MybatisPlusAutoConfiguration中绑定了MybatisPlusProperties.class配置类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta"> prefix = &quot;mybatis-plus&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusProperties</span> &#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ResourcePatternResolver</span> <span class="variable">resourceResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line"> <span class="keyword">private</span> String configLocation;</span><br><span class="line"> <span class="keyword">private</span> String[] mapperLocations = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;classpath*:/mapper/**/*.xml&quot;</span>&#125;;</span><br><span class="line"> <span class="keyword">private</span> String typeAliasesPackage;</span><br><span class="line"> <span class="keyword">private</span> Class&lt;?&gt; typeAliasesSuperType;</span><br><span class="line"> <span class="keyword">private</span> String typeHandlersPackage;</span><br><span class="line"> <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">checkConfigLocation</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"> <span class="keyword">private</span> ExecutorType executorType;</span><br><span class="line"> <span class="keyword">private</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">LanguageDriver</span>&gt; defaultScriptingLanguageDriver;</span><br><span class="line"> <span class="keyword">private</span> Properties configurationProperties;</span><br><span class="line"> <span class="meta">@NestedConfigurationProperty</span></span><br><span class="line"> <span class="keyword">private</span> MybatisConfiguration configuration;</span><br><span class="line"> <span class="keyword">private</span> String typeEnumsPackage;</span><br><span class="line"> <span class="meta">@NestedConfigurationProperty</span></span><br><span class="line"> <span class="keyword">private</span> <span class="type">GlobalConfig</span> <span class="variable">globalConfig</span> <span class="operator">=</span> GlobalConfigUtils.defaults();</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现大部分配置都与mybatis相似，但mapperLocations有一个默认值：”classpath*:&#x2F;mapper&#x2F;**&#x2F;*.xml”，因此mapper映射文件最好直接放在类路径下的mapper文件夹下。</p>
<ul>
<li><p>mybatis-plus使用</p>
<ul>
<li><p>mapper接口直接继承mybatis-plus提供的BaseMapper</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">XxxMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Xxx&gt; &#123;</span><br><span class="line">    Xxx <span class="title function_">selectXxxByUsername</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在BaseMapper中提供了CRUD操作</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BaseMapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(T entity)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByMap</span><span class="params">(<span class="meta">@Param(&quot;cm&quot;)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteBatchIds</span><span class="params">(<span class="meta">@Param(&quot;coll&quot;)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateById</span><span class="params">(<span class="meta">@Param(&quot;et&quot;)</span> T entity)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(&quot;et&quot;)</span> T entity, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">selectById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectBatchIds</span><span class="params">(<span class="meta">@Param(&quot;coll&quot;)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectByMap</span><span class="params">(<span class="meta">@Param(&quot;cm&quot;)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">selectOne</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    Integer <span class="title function_">selectCount</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMaps</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Object&gt; <span class="title function_">selectObjs</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;T&gt;&gt; E <span class="title function_">selectPage</span><span class="params">(E page, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;E <span class="keyword">extends</span> <span class="title class_">IPage</span>&lt;Map&lt;String, Object&gt;&gt;&gt; E <span class="title function_">selectMapsPage</span><span class="params">(E page, <span class="meta">@Param(&quot;ew&quot;)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>service层操作</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">XxxService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Xxx&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XxxServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;XxxMapper, Xxx&gt; <span class="keyword">implements</span> <span class="title class_">XxxService</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="5-NoSQl"><a href="#5-NoSQl" class="headerlink" title="5.NoSQl"></a>5.NoSQl</h4></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">王小小友</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/10/09/SpringBoot%E6%A0%B8%E5%BF%83/">http://example.com/2023/10/09/SpringBoot%E6%A0%B8%E5%BF%83/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">幸运的是遇见你</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/bloghead.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2023/10/10/reggie%E5%A4%96%E5%8D%96%E9%A1%B9%E7%9B%AE/" title=""><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/bloghead.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">王小小友</div><div class="author-info__description">学会学不会</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>我的github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">最强是世人对你的诅咒</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E6%A0%B8%E5%BF%83"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot核心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.0.1.</span> <span class="toc-text">一、配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-yaml"><span class="toc-number">1.0.1.1.</span> <span class="toc-text">1.yaml</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Web%E5%BC%80%E5%8F%91"><span class="toc-number">1.0.2.</span> <span class="toc-text">二、Web开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%A6%82%E8%A7%88"><span class="toc-number">1.0.2.1.</span> <span class="toc-text">1.SpringMVC自动配置概览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%AE%80%E5%8D%95%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">1.0.2.2.</span> <span class="toc-text">2.简单功能分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-springMVC%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.0.2.3.</span> <span class="toc-text">3.springMVC常用参数注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%B3%A8%E8%A7%A3%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.0.2.4.</span> <span class="toc-text">4.注解参数获取__源码分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.0.2.5.</span> <span class="toc-text">5.复杂参数__源码分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1%E8%8E%B7%E5%8F%96-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.0.2.6.</span> <span class="toc-text">6.自定义对象获取_源码分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">1.0.2.7.</span> <span class="toc-text">8.视图解析与模板引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E6%A8%A1%E6%9D%BF%E8%A7%A3%E6%9E%90-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.0.2.8.</span> <span class="toc-text">8.3 模板解析__源码分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E6%8B%A6%E6%88%AA%E5%99%A8-Intercepter"><span class="toc-number">1.0.2.9.</span> <span class="toc-text">9.拦截器(Intercepter)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-MultipartFile"><span class="toc-number">1.0.2.10.</span> <span class="toc-text">10.文件上传(MultipartFile)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-number">1.0.2.11.</span> <span class="toc-text">11.错误处理机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-Web%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%85%A5"><span class="toc-number">1.0.2.12.</span> <span class="toc-text">12.Web原生组件注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%88%87%E6%8D%A2web%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AE%9A%E5%88%B6%E5%8C%96"><span class="toc-number">1.0.2.13.</span> <span class="toc-text">13.嵌入式Servlet容器_源码分析(切换web服务器与定制化)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-%E5%AE%9A%E5%88%B6%E5%8C%96%E5%8E%9F%E7%90%86%E5%A5%97%E8%B7%AF"><span class="toc-number">1.0.2.14.</span> <span class="toc-text">14.定制化原理套路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-druid%E6%95%B0%E6%8D%AE%E6%BA%90starter%E6%95%B4%E5%90%88"><span class="toc-number">1.0.2.15.</span> <span class="toc-text">2.druid数据源starter整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%95%B4%E5%90%88mybatis"><span class="toc-number">1.0.2.16.</span> <span class="toc-text">3.整合mybatis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%95%B4%E5%90%88mybatis-plus"><span class="toc-number">1.0.2.17.</span> <span class="toc-text">4.整合mybatis-plus</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-NoSQl"><span class="toc-number">1.0.2.18.</span> <span class="toc-text">5.NoSQl</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/10/reggie%E5%A4%96%E5%8D%96%E9%A1%B9%E7%9B%AE/" title="无题">无题</a><time datetime="2023-10-10T07:47:50.505Z" title="发表于 2023-10-10 15:47:50">2023-10-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/09/SpringBoot%E6%A0%B8%E5%BF%83/" title="SpringBoot核心">SpringBoot核心</a><time datetime="2023-10-09T13:56:49.000Z" title="发表于 2023-10-09 21:56:49">2023-10-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 王小小友</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>